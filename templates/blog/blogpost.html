{% extends 'base.html' %}
{% block blogactive %} active {% endblock blogactive %}
{% block body %}
{% load humanize %}
{% load extras %}
<div class="container my-4 blog-post">
  <h2 class="blog-post-title"><a class="text-dark" href="/blog/{{post.slug}}">{{post.title}}</a></h2>
  <p class="blog-post-meta">{{post.timesp}} by <a href="#">{{post.author}}</a> <span>{{post.views}} View</span></p>

  <blockquote>
    <p>{{post.content|safe}}</p>

  </blockquote>
</div>

<div class="container my-2">
  <h2>Leave a Comment ({{comment.count}})</h2>
  <div class='my-2'>
    {% if user.is_authenticated %}
    <form action="/blog/postcomments" method="post">
      <div class="form-group">
        <!-- <label for="exampleInputEmail1">Post Comment </label> -->
        <textarea cols="20" rows="8" class="form-control" name="comment" placeholder="Type here.."
          aria-required="true"></textarea>
  
      </div>
      <input type="hidden" name="postSno" value="{{post.sno}}">
      <input type="hidden" name="parentSno" value="">

      {% csrf_token %}
      <button type="submit " class="btn btn-primary my-3">Post Comment »</button>
  
    </form>
    {% else %}
    <p>Plaese Login Comment</p>
    {% endif %}
  
</div>


  <div class="dropdown-divider"></div>
  {% for comment in comment %}
  <div class="row my-2">
    <div class="col-md-1">
      <img src="/static/img/user.png" alt="user" class="w-100 border-dark p-1 border">
    </div>
    <div class="col-md-10"><h4>{{comment.user}}</h4>
      <span class="badge badge-pill bg-dark text-light">{{comment.timestamp | naturaltime}}</span><br> {{comment.comment}}
      <div class="reply mx-0 my-2 ">
        {% if user.is_authenticated %}
        <p>
          <button class="btn-sm btn-primary" type="button" data-toggle="collapse" data-target="#replyBox{{comment.sno}}" aria-expanded="false" aria-controls="collapseExample">
            Reply 
          </button>
        </p>
        <div class="collapse" id="replyBox{{comment.sno}}">
          <div class="card card-body">
            <form action="/blog/postcomments" method="post">
              <div class="form-group">
                <!-- <label for="exampleInputEmail1">Post Comment </label> -->
                <textarea cols="10" rows="4" class="form-control" name="comment" placeholder="Type here.."
                  aria-required="true"></textarea>
              <input type="hidden" name="parentSno" value="{{comment.sno}}">

          
              </div>
              <input type="hidden" name="postSno" value="{{post.sno}}">
              {% csrf_token %}
              <button type="submit " class="btn btn-primary my-3">Post Comment »</button>
          
            </form>
          </div>
        </div>
        {% else %}
        <button class="btn-sm btn-primary" type="button" data-toggle="collapse" data-target="#replyBox{{comment.sno}}" aria-expanded="false" aria-controls="collapseExample" disabled>
          Reply to Login 
        </button>
        {% endif %}
            <div class="replies mx-1 ">
              {% for reply in replyDict|get_val:comment.sno %}
              <div class="row my-2">
                <div class="col-md-1">
                  <img src="/static/img/user.png" alt="user" class="w-100 border-dark p-1 border">
                </div>
                <div class="col-md-10"><h4>{{comment.user}}</h4>
                  <span class="badge badge-pill bg-dark text-light">{{comment.timestamp | naturaltime}}</span><br>
                  <p>{{reply.comment}}</p>
                </div>
              </div>
                   <br>
              {% endfor %}
            </div>

          
        
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% endblock body %}